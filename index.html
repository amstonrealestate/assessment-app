<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#ffffff">
  <title>Assisted Living Assessment App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
  <link rel="manifest" href='data:application/manifest+json,{
    "name": "Assessment App",
    "short_name": "Assessment",
    "start_url": ".",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#ffffff"
  }'>
  <style>
    canvas { border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { jsPDF } = window.jspdf;

    function App() {
      const [rates, setRates] = useState(() => {
        const savedRates = localStorage.getItem('rates');
        return savedRates ? JSON.parse(savedRates) : {
          moverHourly: 75,
          vehicleFlat: 50,
          mileageRate: 1,
          packingFee: 200,
          itemHandling: 0,
          materialsCost: 0,
          bubbleWrapCostPerFoot: 0.4,
          boxCost: 4,
          paperPadCostPerBox: 23.75,
          dishPackCost: 4.3,
        };
      });

      const [formData, setFormData] = useState({
        clientName: '',
        rooms: [
          {
            name: 'Living Room',
            width: '',
            length: '',
            items: [],
            photos: [],
            estimatedMaterials: { boxes: 0, bubbleWrapFeet: 0, paperPadBoxes: 0, dishPacks: 0 },
            overrideMaterials: { boxes: 0, bubbleWrapFeet: 0, paperPadBoxes: 0, dishPacks: 0 },
          }
        ],
        movers: 2,
        hoursLow: 4,
        hoursHigh: 5,
        vehicles: 1,
        mileage: 10,
        packing: false,
        materials: 0,
      });
      const canvasRef = useRef(null);
      const [selectedRoomIndex, setSelectedRoomIndex] = useState(0);
      const [model, setModel] = useState(null);
      const [loadingModel, setLoadingModel] = useState(true);

      useEffect(() => {
        cocoSsd.load().then(loadedModel => {
          setModel(loadedModel);
          setLoadingModel(false);
        }).catch(err => console.error('Model loading failed:', err));
      }, []);

      useEffect(() => {
        localStorage.setItem('rates', JSON.stringify(rates));
      }, [rates]);

      const handleInputChange = (e, roomIndex = null, itemIndex = null, field = null) => {
        if (roomIndex !== null && itemIndex === null) {
          const newRooms = [...formData.rooms];
          newRooms[roomIndex][e.target.name] = e.target.value;
          setFormData({ ...formData, rooms: newRooms });
        } else if (roomIndex !== null && itemIndex !== null && field) {
          const newRooms = [...formData.rooms];
          newRooms[roomIndex].items[itemIndex][field] = e.target.value;
          setFormData({ ...formData, rooms: newRooms });
        } else {
          setFormData({ ...formData, [e.target.name]: e.target.value });
        }
      };

      const handleOverrideChange = (e, roomIndex, field) => {
        const newRooms = [...formData.rooms];
        newRooms[roomIndex].overrideMaterials[field] = parseFloat(e.target.value) || 0;
        setFormData({ ...formData, rooms: newRooms });
      };

      const handleRateChange = (e) => {
        setRates({ ...rates, [e.target.name]: parseFloat(e.target.value) || 0 });
      };

      const addRoom = () => {
        setFormData({
          ...formData,
          rooms: [...formData.rooms, { name: '', width: '', length: '', items: [], photos: [], estimatedMaterials: { boxes: 0, bubbleWrapFeet: 0, paperPadBoxes: 0, dishPacks: 0 }, overrideMaterials: { boxes: 0, bubbleWrapFeet: 0, paperPadBoxes: 0, dishPacks: 0 } }],
        });
      };

      const addItemToRoom = (roomIndex) => {
        const newRooms = [...formData.rooms];
        newRooms[roomIndex].items.push({ name: '', width: '', length: '', height: '' });
        setFormData({ ...formData, rooms: newRooms });
      };

      const handlePhotoUpload = (e, roomIndex) => {
        const file = e.target.files[0];
        if (file) {
          const photoUrl = URL.createObjectURL(file);
          const newRooms = [...formData.rooms];
          newRooms[roomIndex].photos.push(photoUrl);
          setFormData({ ...formData, rooms: newRooms });
          setTimeout(() => analyzePhoto(photoUrl, roomIndex), 1000);
        }
      };

      const removePhoto = (roomIndex, photoIndex) => {
        const newRooms = [...formData.rooms];
        newRooms[roomIndex].photos.splice(photoIndex, 1);
        // Re-calculate estimated materials by re-analyzing remaining photos
        newRooms[roomIndex].estimatedMaterials = { boxes: 0, bubbleWrapFeet: 0, paperPadBoxes: 0, dishPacks: 0 };
        newRooms[roomIndex].photos.forEach(photoUrl => analyzePhoto(photoUrl, roomIndex, true)); // Aggregate mode
        setFormData({ ...formData, rooms: newRooms });
      };

      const analyzePhoto = async (photoUrl, roomIndex, aggregate = false) => {
        if (loadingModel || !model) return;

        try {
          const img = new Image();
          img.src = photoUrl;
          await new Promise(resolve => { img.onload = resolve; });

          const predictions = await model.detect(img);
          let dishCount = 0;
          let bookCount = 0;
          predictions.forEach(pred => {
            if (['cup', 'bowl', 'bottle', 'wine glass', 'fork', 'knife', 'spoon'].includes(pred.class)) {
              dishCount++;
            } else if (pred.class === 'book') {
              bookCount++;
            }
          });

          const dishPacks = Math.ceil(dishCount / 20);
          const paperPadBoxes = Math.ceil((dishCount * 4) / 25);
          const bubbleWrapFeet = dishCount * 2;
          const boxes = Math.ceil(dishCount / 20) + Math.ceil(bookCount / 30); // Added for books: ~30 books per box

          const newRooms = [...formData.rooms];
          if (aggregate) {
            newRooms[roomIndex].estimatedMaterials.boxes += boxes;
            newRooms[roomIndex].estimatedMaterials.bubbleWrapFeet += bubbleWrapFeet;
            newRooms[roomIndex].estimatedMaterials.paperPadBoxes += paperPadBoxes;
            newRooms[roomIndex].estimatedMaterials.dishPacks += dishPacks;
          } else {
            newRooms[roomIndex].estimatedMaterials = { boxes, bubbleWrapFeet, paperPadBoxes, dishPacks };
          }
          setFormData({ ...formData, rooms: newRooms });
        } catch (err) {
          console.error('Photo analysis failed:', err);
        }
      };

      const calculateEstimate = () => {
        const totalItems = formData.rooms.reduce((sum, room) => sum + room.items.length, 0);
        let totalMaterialsCost = rates.materialsCost + (parseFloat(formData.materials) || 0);

        formData.rooms.forEach(room => {
          const mat = room.estimatedMaterials;
          const override = room.overrideMaterials;
          totalMaterialsCost += (mat.boxes + override.boxes) * rates.boxCost;
          totalMaterialsCost += (mat.bubbleWrapFeet + override.bubbleWrapFeet) * rates.bubbleWrapCostPerFoot;
          totalMaterialsCost += (mat.paperPadBoxes + override.paperPadBoxes) * rates.paperPadCostPerBox;
          totalMaterialsCost += (mat.dishPacks + override.dishPacks) * rates.dishPackCost;
        });

        const laborLow = formData.movers * rates.moverHourly * (parseFloat(formData.hoursLow) || 0);
        const laborHigh = formData.movers * rates.moverHourly * (parseFloat(formData.hoursHigh) || 0);
        const vehicleLow = formData.vehicles * rates.vehicleFlat + formData.mileage * rates.mileageRate;
        const vehicleHigh = vehicleLow * 1.2;
        const packingCost = formData.packing ? rates.packingFee : 0;
        const itemCost = totalItems * rates.itemHandling;
        const low = (laborLow + vehicleLow + packingCost + itemCost + totalMaterialsCost).toFixed(2);
        const high = (laborHigh + vehicleHigh + packingCost + itemCost + totalMaterialsCost).toFixed(2);
        return { low, high };
      };

      const generatePDF = () => {
        const { low, high } = calculateEstimate();
        const doc = new jsPDF();
        doc.text(`Quote for ${formData.clientName}`, 10, 10);
        doc.text(`Total Estimate: $${low} - $${high}`, 10, 20);
        doc.text(`Number of Movers: ${formData.movers}`, 10, 30);
        doc.text(`Labor Hours (Low/High): ${formData.hoursLow}/${formData.hoursHigh}`, 10, 40);
        doc.text(`Number of Vehicles: ${formData.vehicles}`, 10, 50);
        doc.text(`Mileage (miles): ${formData.mileage}`, 10, 60);
        doc.text(`Packing Service: ${formData.packing ? 'Yes' : 'No'}`, 10, 70);
        doc.text(`Additional Materials Cost: $${formData.materials}`, 10, 80);
        doc.text('Rooms and Items:', 10, 90);
        let yPos = 100;
        formData.rooms.forEach((room, rIdx) => {
          doc.text(`${room.name} (${room.width}x${room.length} ft):`, 10, yPos);
          yPos += 10;
          room.items.forEach((item, i) => {
            doc.text(`  - ${item.name}: ${item.width || 'N/A'}x${item.length || 'N/A'}x${item.height || 'N/A'}`, 10, yPos);
            yPos += 10;
          });
          const mat = room.estimatedMaterials;
          const override = room.overrideMaterials;
          doc.text(`  Estimated Materials (Auto + Override): ${(mat.boxes + override.boxes)} boxes, ${(mat.bubbleWrapFeet + override.bubbleWrapFeet)} ft bubble wrap, ${(mat.paperPadBoxes + override.paperPadBoxes)} paper pad boxes, ${(mat.dishPacks + override.dishPacks)} dish packs`, 10, yPos);
          yPos += 10;
        });
        doc.save(`${formData.clientName}_quote.pdf`);
      };

      const exportToCSV = () => {
        const { low, high } = calculateEstimate();
        const headers = ['Client Name', 'Number of Movers', 'Labor Hours Low', 'Labor Hours High', 'Number of Vehicles', 'Mileage (miles)', 'Packing Service', 'Materials Cost', 'Total Low', 'Total High', 'Rooms'];
        const roomsStr = formData.rooms.map(room => 
          `${room.name} (${room.width}x${room.length}): Items - ${room.items.map(item => `${item.name} (${item.width || 'N/A'}x${item.length || 'N/A'}x${item.height || 'N/A'})`).join('; ')}; Materials - Boxes: ${room.estimatedMaterials.boxes + room.overrideMaterials.boxes}, Bubble: ${room.estimatedMaterials.bubbleWrapFeet + room.overrideMaterials.bubbleWrapFeet}ft, Paper Pads: ${room.estimatedMaterials.paperPadBoxes + room.overrideMaterials.paperPadBoxes}, Dish Packs: ${room.estimatedMaterials.dishPacks + room.overrideMaterials.dishPacks}`
        ).join(' | ');
        const row = [
          formData.clientName,
          formData.movers,
          formData.hoursLow,
          formData.hoursHigh,
          formData.vehicles,
          formData.mileage,
          formData.packing,
          formData.materials,
          low,
          high,
          roomsStr,
        ];
        const csv = [headers.join(','), row.join(',')].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${formData.clientName}_assessment.csv`;
        a.click();
        URL.revokeObjectURL(url);
      };

      useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        const scale = 10;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const room = formData.rooms[selectedRoomIndex];
        if (!room) return;

        const roomWidth = parseFloat(room.width) * scale || 100;
        const roomLength = parseFloat(room.length) * scale || 100;
        ctx.strokeStyle = 'black';
        ctx.strokeRect(0, 0, roomWidth, roomLength);

        room.items.forEach((item, i) => {
          const width = parseFloat(item.width) * scale || 10;
          const length = parseFloat(item.length) * scale || 10;
          ctx.fillStyle = `hsl(${i * 60}, 50%, 50%)`;
          ctx.fillRect(10 + i * 20, 10 + i * 20, width, length);
          ctx.fillStyle = 'white';
          ctx.fillText(item.name || `Item ${i + 1}`, 12 + i * 20, 20 + i * 20);
        });
      }, [formData.rooms, selectedRoomIndex]);

      return (
        <div className="p-4 max-w-md mx-auto bg-gray-100 min-h-screen">
          <h1 className="text-2xl font-bold mb-4">Assessment App</h1>

          <div className="mb-6 p-4 border rounded bg-white">
            <h2 className="text-lg font-semibold mb-2">Configuration Settings</h2>
            <p className="text-sm text-gray-600 mb-2">Adjust rates (saved locally for future use)</p>
            <div className="grid grid-cols-2 gap-2">
              <div>
                <label className="block text-sm font-medium">Mover Hourly Rate ($)</label>
                <input type="number" name="moverHourly" value={rates.moverHourly} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Vehicle Flat Cost ($)</label>
                <input type="number" name="vehicleFlat" value={rates.vehicleFlat} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Mileage Rate ($/mile)</label>
                <input type="number" name="mileageRate" value={rates.mileageRate} onChange={handleRateChange} className="w-full p-2 border rounded" step="0.01" />
              </div>
              <div>
                <label className="block text-sm font-medium">Packing Flat Fee ($)</label>
                <input type="number" name="packingFee" value={rates.packingFee} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Per Item Handling ($)</label>
                <input type="number" name="itemHandling" value={rates.itemHandling} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Base Materials Cost ($)</label>
                <input type="number" name="materialsCost" value={rates.materialsCost} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Bubble Wrap Cost (/ft)</label>
                <input type="number" name="bubbleWrapCostPerFoot" value={rates.bubbleWrapCostPerFoot} onChange={handleRateChange} className="w-full p-2 border rounded" step="0.01" />
              </div>
              <div>
                <label className="block text-sm font-medium">Box Cost ($)</label>
                <input type="number" name="boxCost" value={rates.boxCost} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Paper Pad Cost (/box)</label>
                <input type="number" name="paperPadCostPerBox" value={rates.paperPadCostPerBox} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
              <div>
                <label className="block text-sm font-medium">Dish Pack Cost ($)</label>
                <input type="number" name="dishPackCost" value={rates.dishPackCost} onChange={handleRateChange} className="w-full p-2 border rounded" />
              </div>
            </div>
          </div>

          <div className="mb-4">
            <label className="block text-sm font-medium">Client Name</label>
            <input
              type="text"
              name="clientName"
              value={formData.clientName}
              onChange={handleInputChange}
              className="w-full p-2 border rounded"
              placeholder="Enter client name"
            />
          </div>

          <div className="mb-4">
            <h2 className="text-lg font-semibold mb-2">Rooms in New Space</h2>
            {formData.rooms.map((room, roomIndex) => (
              <div key={roomIndex} className="mb-4 p-4 border rounded bg-white">
                <input
                  type="text"
                  name="name"
                  value={room.name}
                  onChange={(e) => handleInputChange(e, roomIndex)}
                  className="w-full p-2 border rounded mb-2"
                  placeholder="Room Name (e.g., Living Room)"
                />
                <div className="flex gap-2 mb-2">
                  <input
                    type="number"
                    name="width"
                    value={room.width}
                    onChange={(e) => handleInputChange(e, roomIndex)}
                    className="w-1/2 p-2 border rounded"
                    placeholder="Width (ft) - optional"
                  />
                  <input
                    type="number"
                    name="length"
                    value={room.length}
                    onChange={(e) => handleInputChange(e, roomIndex)}
                    className="w-1/2 p-2 border rounded"
                    placeholder="Length (ft) - optional"
                  />
                </div>

                <div className="mb-2">
                  <label className="block text-sm font-medium">Upload Room Photo</label>
                  <input
                    type="file"
                    accept="image/*"
                    onChange={(e) => handlePhotoUpload(e, roomIndex)}
                    className="w-full p-2 border rounded"
                  />
                </div>

                {room.photos.length > 0 && (
                  <div className="grid grid-cols-3 gap-2 mb-2">
                    {room.photos.map((photoUrl, photoIndex) => (
                      <div key={photoIndex} className="relative">
                        <img src={photoUrl} alt={`Photo ${photoIndex + 1}`} className="w-full h-20 object-cover rounded" />
                        <button
                          onClick={() => removePhoto(roomIndex, photoIndex)}
                          className="absolute top-0 right-0 bg-red-500 text-white px-1 py-0.5 text-xs rounded"
                        >
                          Remove
                        </button>
                      </div>
                    ))}
                  </div>
                )}

                <div className="mb-2 text-sm">
                  Auto-Estimated Materials: {room.estimatedMaterials.boxes} boxes, {room.estimatedMaterials.bubbleWrapFeet} ft bubble wrap, {room.estimatedMaterials.paperPadBoxes} paper pad boxes, {room.estimatedMaterials.dishPacks} dish packs
                </div>

                <div className="mb-2">
                  <h3 className="text-md font-medium mb-1">Manual Material Overrides (Add/Adjust)</h3>
                  <div className="grid grid-cols-2 gap-2">
                    <div>
                      <label className="block text-sm">Boxes</label>
                      <input
                        type="number"
                        value={room.overrideMaterials.boxes}
                        onChange={(e) => handleOverrideChange(e, roomIndex, 'boxes')}
                        className="w-full p-1 border rounded"
                        placeholder="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm">Bubble Wrap (ft)</label>
                      <input
                        type="number"
                        value={room.overrideMaterials.bubbleWrapFeet}
                        onChange={(e) => handleOverrideChange(e, roomIndex, 'bubbleWrapFeet')}
                        className="w-full p-1 border rounded"
                        placeholder="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm">Paper Pad Boxes</label>
                      <input
                        type="number"
                        value={room.overrideMaterials.paperPadBoxes}
                        onChange={(e) => handleOverrideChange(e, roomIndex, 'paperPadBoxes')}
                        className="w-full p-1 border rounded"
                        placeholder="0"
                      />
                    </div>
                    <div>
                      <label className="block text-sm">Dish Packs</label>
                      <input
                        type="number"
                        value={room.overrideMaterials.dishPacks}
                        onChange={(e) => handleOverrideChange(e, roomIndex, 'dishPacks')}
                        className="w-full p-1 border rounded"
                        placeholder="0"
                      />
                    </div>
                  </div>
                </div>

                <h3 className="text-md font-medium mb-1">Furniture Items</h3>
                {room.items.map((item, itemIndex) => (
                  <div key={itemIndex} className="mb-2 p-2 border rounded">
                    <input
                      type="text"
                      placeholder="Item name"
                      value={item.name}
                      onChange={(e) => handleInputChange(e, roomIndex, itemIndex, 'name')}
                      className="w-full p-1 mb-1 border rounded"
                    />
                    <div className="flex gap-2">
                      <input
                        type="number"
                        placeholder="Width (ft) - optional"
                        value={item.width}
                        onChange={(e) => handleInputChange(e, roomIndex, itemIndex, 'width')}
                        className="w-1/3 p-1 border rounded"
                      />
                      <input
                        type="number"
                        placeholder="Length (ft) - optional"
                        value={item.length}
                        onChange={(e) => handleInputChange(e, roomIndex, itemIndex, 'length')}
                        className="w-1/3 p-1 border rounded"
                      />
                      <input
                        type="number"
                        placeholder="Height (ft) - optional"
                        value={item.height}
                        onChange={(e) => handleInputChange(e, roomIndex, itemIndex, 'height')}
                        className="w-1/3 p-1 border rounded"
                      />
                    </div>
                  </div>
                ))}
                <button
                  onClick={() => addItemToRoom(roomIndex)}
                  className="bg-blue-500 text-white px-4 py-2 rounded mt-2"
                >
                  Add Item to {room.name || 'this Room'}
                </button>
              </div>
            ))}
            <button
              onClick={addRoom}
              className="bg-green-500 text-white px-4 py-2 rounded"
            >
              Add New Room
            </button>
          </div>

          <div className="mb-4">
            <h2 className="text-lg font-semibold">Estimate Details</h2>
            <div className="grid grid-cols-2 gap-2">
              <div>
                <label className="block text-sm font-medium">Number of Movers</label>
                <input
                  type="number"
                  name="movers"
                  value={formData.movers}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="Movers"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">Number of Vehicles</label>
                <input
                  type="number"
                  name="vehicles"
                  value={formData.vehicles}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="Vehicles"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">Labor Hours Low</label>
                <input
                  type="number"
                  name="hoursLow"
                  value={formData.hoursLow}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="Low Hours"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">Labor Hours High</label>
                <input
                  type="number"
                  name="hoursHigh"
                  value={formData.hoursHigh}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="High Hours"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">Mileage (miles)</label>
                <input
                  type="number"
                  name="mileage"
                  value={formData.mileage}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="Mileage"
                />
              </div>
              <div>
                <label className="block text-sm font-medium">Additional Materials Cost ($)</label>
                <input
                  type="number"
                  name="materials"
                  value={formData.materials}
                  onChange={handleInputChange}
                  className="w-full p-2 border rounded"
                  placeholder="Materials"
                />
              </div>
            </div>
            <label className="flex items-center mt-2">
              <input
                type="checkbox"
                name="packing"
                checked={formData.packing}
                onChange={(e) => setFormData({ ...formData, packing: e.target.checked })}
                className="mr-2"
              />
              Packing Service Needed
            </label>
          </div>

          <div className="mb-4">
            <h2 className="text-lg font-semibold">Room Visualization</h2>
            <select
              value={selectedRoomIndex}
              onChange={(e) => setSelectedRoomIndex(parseInt(e.target.value))}
              className="w-full p-2 border rounded mb-2"
            >
              {formData.rooms.map((room, index) => (
                <option key={index} value={index}>
                  {room.name || `Room ${index + 1}`}
                </option>
              ))}
            </select>
            <canvas ref={canvasRef} width="300" height="300" className="w-full"></canvas>
            <p className="text-sm text-gray-600">Preview of items in selected room (colored rectangles).</p>
          </div>

          <div className="mb-4">
            <h2 className="text-lg font-semibold">Estimate: ${calculateEstimate().low} - ${calculateEstimate().high}</h2>
            <div className="flex gap-2">
              <button
                onClick={generatePDF}
                className="bg-green-500 text-white px-4 py-2 rounded"
              >
                Download Quote PDF
              </button>
              <button
                onClick={exportToCSV}
                className="bg-gray-500 text-white px-4 py-2 rounded"
              >
                Export to CSV
              </button>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>